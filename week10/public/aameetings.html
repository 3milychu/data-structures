<html>
    <head>
        <title>AA Meetings</title>
        <link href="https://fonts.googleapis.com/css?family=Nunito:200,300,400,600,700,900" rel="stylesheet">
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
        <link href="https://cdnjs.cloudflare.com/ajax/libs/multiple-select/1.2.0/multiple-select.css" media="screen" rel="stylesheet" type="text/css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/multiple-select/1.2.0/multiple-select.js"></script>
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css"
       integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
       crossorigin=""/>
    </head>
    <style>
    body, html {
        top:0;
        left:0;
        margin:0;
        font-family:'Nunito', sans-serif;
    }
    .main {
        width:70%;
        display:inline-block;
        padding:2%;
    }
    .myplan {
        width:21%;
        float:right;
        display:inline-block;
        background-color:#F2F2F2;
        height:100%;
        vertical-align:top;
        padding:2%;
    }
    #map {
        float:right;
        width:45%;
        height:70vh;
        display:inline-block;
   }
   .filter {
       display:inline-block;
   }
   .section p {
       display:inline-block;
   }
   .header h1 {
       font-weight:100;
       margin:0%;
       line-height:1.2em;
   }
   .header h2 {
       text-transform:uppercase;
       font-weight:900;
       font-size:0.9em;
       letter-spacing:0.02em;
       margin:0%;
   }
   .section {
       margin-top:2%;
   }
   .section h3{
       font-size:0.7em;
       letter-spacing:0.1em;
       font-weight:300;
       text-transform:uppercase;
   }
  input[type=checkbox] {
       margin-right: 1%!important;
   }
   .results {
       margin-top:2%;
   }
   .list {
       width:50%;
       height:70vh;
       overflow-y:hidden;
       display:inline-block;
   }
   #results-summary{
       font-size:0.8em;
       font-weight:300;
       font-style:italic;
       margin:0%;
   }
   #filtered-entries{
       height:100%;
       overflow-y:scroll;
   }
   .entry, .myplan-selections div {
       padding: 5% 0% 5% 0%;
       margin:0%;
       cursor:pointer;
       transition:0.5s ease-in-out;
   }
   .entry:hover {
       background-color:#E5F0F8;
   }
   .entry h2, .myplan-selections h2 {
       line-height:1.2em;
       font-weight:900;
       margin:0%;
       font-size:0.8em;
   }
   .entry p, .myplan-selections p {
       line-height:1.2em;
       font-size:0.8em;
       font-weight:300;
       margin:0%;
   }
   .leaflet-popup-content {
       background-color:#313131;
       color:white;
       font-weight:400;
       padding:1%;
       font-family:'Nunito', sans-serif;
   }
   .leaflet-popup-content h2{
       margin:0%;
       font-weight:900;
       font-size:1em;
       line-height:0.1em;
   }
   .leaflet-popup-content p{
       margin:0%;
       padding:0%;
       line-height:0.1em;
       font-weight:300;
       font-size:0.8em;
   }
    .leaflet-popup-content em {
        font-style: normal;
        /*font-weight:600;*/
        /*letter-spacing:0.05em;*/
        /*text-transform:uppercase;*/
    }
   .leaflet-popup-content-wrapper, .leaflet-popup-tip {
       background:#313131;
   }
   
   </style>
<body>

<div class="main">
<!--Header-->
<div class="header">
    <h1>AA Meetings</h1>
    <h2>New York, NY</h2>   
</div>
<!--Selection-->
<div class="selection">
    <div class="section">
        <h3>Day and Time</h3>
        <div class="filter">
            <select size="7" name="days" multiple="multiple" id="days">
                <option value="Sunday">Sundays</option>
                <option value="Monday">Mondays</option>
                <option value="Tuesday">Tuesdays</option>
                <option value="Wednesday">Wednesdays</option>
                <option value="Thursday">Thursdays</option>
                <option value="Friday">Fridays</option>
                <option value="Saturday">Saturdays</option>
            </select>
        </div>
        <p>between</p>
        <div class="filter">
            <select size="18" name="start" multiple="multiple" id="start">
                <option value=6>6  AM</option>
                <option value=7>7  AM</option>
                <option value="8 ">8  AM</option>
                <option value="9 ">9  AM</option>
                <option value="10 ">10  AM</option>
                <option value="11 ">11  AM</option>
                <option value="12 ">12  PM</option>
                <option value="13 ">1  PM</option>
                <option value="14 ">2  PM</option>
                <option value="15 ">3  PM</option>
                <option value="16 ">4  PM</option>
                <option value="17 ">5  PM</option>
                <option value="18 ">6  PM</option>
                <option value="19 ">7  PM</option>
                <option value="20 ">8  PM</option>
                <option value="21 ">9  PM</option>
                <option value="22 ">10  PM</option>
                <option value="23 ">11  PM</option>
            </select>
        </div>
        <p>and</p>
        <div class="filter">
            <select size="18" name="end" multiple="multiple" id="end">
                <option value="6">6  AM</option>
                <option value="7">7  AM</option>
                <option value="8">8  AM</option>
                <option value="9 ">9  AM</option>
                <option value="10 ">10  AM</option>
                <option value="11 ">11  AM</option>
                <option value="12 ">12  PM</option>
                <option value="13 ">1  PM</option>
                <option value="14 ">2  PM</option>
                <option value="15 ">3  PM</option>
                <option value="16 ">4  PM</option>
                <option value="17 ">5  PM</option>
                <option value="18 ">6  PM</option>
                <option value="19 ">7  PM</option>
                <option value="20 ">8  PM</option>
                <option value="21 ">9  PM</option>
                <option value="22 ">10  PM</option>
                <option value="23 ">11  PM</option>
            </select>
        </div>
        
    </div>
</div>
<hr>
<!--Results-->
<div class="results">
    <!--List-->
    <div class="list">
        <p id="results-summary"></p>
        <div id="filtered-entries"></div>
    </div>
    <!--Map-->
    <div id="map"></div>
     <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js"
       integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA=="
       crossorigin=""></script>
</div>
<!--end main div-->
</div>

<div class="myplan">
    <h2>My Plan</h2>
    <div class="myplan-selections"></div>
</div>
</body>
<script>
$('#days').multipleSelect({
    width:250,
    placeholder: "Select a Day",
    allSelected: "Any Day"
});
$('#start').multipleSelect({
    width:150,
    placeholder: "Start Time",
    allSelected: "Any Time"
});
$('#end').multipleSelect({
    width:150,
    placeholder: "End Time",
    allSelected: "Any Time"
});
</script>
<script src="/script.js"></script>
<script>
    var results_summary = document.querySelector('#results-summary');
    var filtered_entries = document.querySelector('#filtered-entries');
    
    getlist(data);
    
    function time(decimal_time){
    decimal_time = decimal_time.toString();
     var hour = decimal_time.split(".")[0];
     var min = decimal_time.split(".")[1];
     var ampm;
     hour = (hour < 10) ? ("0" + hour) : hour;
     if(hour == 12) {
         hour = 12;
         ampm = "PM";
         } else if (hour>12) {
         hour = hour-12;
         ampm = "PM";
     } else {
         hour = hour;
         ampm = "AM";
     }
     if(min!=null){
         min = (min < 10) ? (min + "0") : min;
     } else {
         min = "00";
     }
     return hour + ":" + min + " " + ampm;
    }
    
    function getlist(data) {
      results_summary.innerHTML=data.length + " results"; 
      filtered_entries.innerHTML="";
      for(a=0;a<data.length;a++){
        var entry = document.createElement('div');
        entry.id = "entry"+a;
        entry.className="entry";
        var title = document.createElement('h2');
        title.innerHTML= data[a]['name'];
        var mtglocation = document.createElement('h2');
        mtglocation.innerHTML= data[a]['location'];
        var address = document.createElement('p');
        address.innerHTML= data[a]['address'];
        var mtgtime = document.createElement('p');
        mtgtime.innerHTML = data[a]['time_day'] +"s from " + time(data[a]['time_start']) + " - " + time(data[a]['time_end']);
        entry.appendChild(title);
        entry.appendChild(mtglocation);
        entry.appendChild(address);
        entry.appendChild(mtgtime);
        filtered_entries.appendChild(entry); 
        }
    };
    
   
    var filters = document.querySelectorAll('input');
    for(b=0;b<filters.length;b++){
        filters[b].onclick=function(){
            var updated_data = data;
            var checked_days = [];
            var checked_start = [];
            console.log('click registered');
            var checked_value = this.getAttribute('data-name');
            console.log(checked_value);
            // Days filter
            if(checked_value == "selectAllDays"){
                checked_days.push("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday");
                updated_data = data.filter(f => checked_days.includes(f.time_day));
                getlist(updated_data);
                getmap(updated_data);
                myplan();
            } else if (checked_value == "selectItemdays"){
                var checked = document.querySelectorAll('input[data-name=selectItemdays]:checked');
                for(c=0;c<checked.length;c++){
                    checked_days.push(checked[c].value);
                    }
                console.log(checked_days);
                updated_data = data.filter(f => checked_days.includes(f.time_day));
                console.log(updated_data);
                getlist(updated_data);
                getmap(updated_data)
                myplan();
            }
            // Start time filter
            else if(checked_value == "selectItemstart"){
                var checked = document.querySelectorAll('input[data-name=selectItemstart]:checked');
                if(checked.length>0){
                    for(c=0;c<checked.length;c++){
                    checked_start.push(parseFloat(checked[c].value));
                    }
                    console.log(checked_start);
                    updated_data = updated_data.filter(f => checked_start.includes(f.time_start));
                    console.log(updated_data);
                    getlist(updated_data);
                    getmap(updated_data)
                    myplan();
                } else if (checked.length=0){
                    getlist(updated_data);
                    getmap(updated_data)
                    myplan();
                   
                }
                
            }
        }
    }
    
    function myplan() {
        var myplan_selections = document.querySelector('.myplan-selections');
        var entries = document.querySelectorAll('.entry');
        for (var e=0;e<entries.length;e++){
            entries[e].onclick=function() {
                console.log("this clicks");
                var ref = this.id;
                var to_copy = document.querySelector('#'+ref);
                var saved_entry = document.createElement('div');
                saved_entry.innerHTML = to_copy.innerHTML;
                myplan_selections.appendChild(saved_entry);
            }
        }
    }
    myplan();
    
</script>
</html>